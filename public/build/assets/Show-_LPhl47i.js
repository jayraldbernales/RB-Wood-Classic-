import{r as o,A as T,m as F,j as e,L as H,$ as c}from"./app-CupyZw7M.js";import{S as M,N as A}from"./Sidebar-CtOLCLAQ.js";import{L as R}from"./LogOutModal-B-OsEY8z.js";import"./CartModal -JtleBEI8.js";import"./Modal--PeoWE0q.js";import"./divWithClassName-Cl_CX82P.js";import"./index-4SsW87ZX.js";const Q=({cartItems:m,total:t,auth:d})=>{o.useEffect(()=>{T.init(),D()},[]);const[i,v]=o.useState(!0),[w,x]=o.useState(!1),[_,k]=o.useState(""),y=()=>v(!i),{data:a,setData:n,post:S,processing:u}=F({items:m,total_amount:t,down_payment_amount:t*.5,message:"",payment_method:"gcash",payment_type:"full"}),[r,h]=o.useState(1),[b,j]=o.useState(!1),[N,f]=o.useState(null),P=()=>h(s=>Math.min(s+1,3)),C=()=>h(s=>Math.max(s-1,1)),L=async s=>{s.preventDefault(),a.payment_method==="gcash"?await O("gcash"):S(route("orders.store"))},O=async s=>{j(!0),f(null);try{const l=a.payment_type==="full"?t:t*.5,p=await fetch(route("orders.store"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,Accept:"application/json"},body:JSON.stringify({payment_method:a.payment_method,payment_type:a.payment_type,total_amount:t,down_payment_amount:l,items:m,message:a.message||"",is_paid:!1})});if(!p.ok){const E=await p.json();throw new Error(E.error||"Failed to create order")}const $=(await p.json()).order.id,g=await(await fetch(route("paymongo.create-checkout"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,Accept:"application/json"},body:JSON.stringify({amount:l*100,description:"Order Payment",payment_method_type:s,metadata:{order_id:$,order_type:a.payment_type,user_id:d.user.id,amount:l}})})).json();if(g.checkout_url)window.location.href=g.checkout_url;else throw new Error("No checkout URL received")}catch(l){f(l.message)}finally{j(!1)}},D=()=>{if(!window.PayMongo){const s=document.createElement("script");s.src="https://js.paymongo.com/v1/paymongo.js",s.async=!0,s.onload=()=>console.log("PayMongo SDK loaded."),document.body.appendChild(s)}};return e.jsxs("div",{className:`d-flex ${i?"sidebar-open":""}`,style:{overflow:"hidden"},children:[e.jsx(H,{title:"Checkout"}),e.jsx(M,{sidebarOpen:i,toggleSidebar:y}),e.jsxs("div",{className:"content flex-grow-1",style:{marginLeft:i?"220px":"0",transition:"margin-left 0.3s ease",backgroundColor:"#F8F9FA",minHeight:"100vh"},children:[e.jsxs("div",{className:"position-relative",style:{paddingTop:"50px"},children:[e.jsx(A,{toggleSidebar:y,setShowLogoutModal:x,searchTerm:_,setSearchTerm:k}),e.jsx("div",{className:"container-fluid px-0",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-lg-12",children:e.jsxs("div",{className:"px-4 py-5 mt-2",style:{maxWidth:"1000px",margin:"0 auto"},children:[e.jsxs("div",{className:"mb-5",style:{marginBottom:"4rem"},children:[" ",e.jsx("h2",{className:"fw-bold mb-4",children:"Checkout"})," ",e.jsxs("div",{className:"d-flex align-items-center",style:{marginBottom:"3rem"},children:[" ",e.jsxs("div",{className:"flex-grow-1 position-relative",style:{zIndex:1},children:[e.jsx("div",{className:"progress",style:{height:"8px",marginBottom:"2.5rem"},children:e.jsx("div",{className:"progress-bar bg-dark",role:"progressbar",style:{width:`${r/3*100}%`}})}),e.jsx("div",{className:"d-flex justify-content-between position-absolute w-100",style:{top:"1rem"},children:[1,2,3].map(s=>e.jsxs("div",{className:`d-flex flex-column align-items-center ${r>=s?"text-dark":"text-muted"}`,style:{cursor:"pointer"},onClick:()=>r>=s&&h(s),children:[e.jsx("div",{className:`rounded-circle d-flex align-items-center justify-content-center ${r>=s?"bg-dark text-white":"bg-light"}`,style:{width:"36px",height:"36px",fontWeight:"600"},children:s}),e.jsxs("small",{className:"mt-2 text-nowrap",style:{fontSize:"0.85rem"},children:[s===1&&"Order Summary",s===2&&"Delivery Info",s===3&&"Payment"]})]},s))})]})]})]}),e.jsxs("form",{onSubmit:L,children:[r===1&&e.jsxs("div",{className:"card border-0 shadow-sm mb-4",children:[" ",e.jsxs("div",{className:"card-header bg-white border-bottom py-3 mt-4",children:[" ",e.jsx("h4",{className:"mb-0",children:"Order Summary"})]}),e.jsx("div",{className:"card-body p-0",children:e.jsx("div",{className:"list-group list-group-flush",children:m.map(s=>{var l;return e.jsx("div",{className:"list-group-item border-0 py-3 px-4",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("img",{src:((l=s.product.images[0])==null?void 0:l.url)||"/placeholder-image.jpg",alt:s.product.name,className:"rounded me-3",style:{width:"80px",height:"80px",objectFit:"cover"}}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h6",{className:"mb-1 fw-semibold",children:s.product.name}),e.jsxs("p",{className:"text-muted small mb-1",children:["Quantity:"," ",s.quantity]}),e.jsxs("p",{className:"mb-0 fw-semibold",children:["₱",(s.product.price*s.quantity).toLocaleString("en-PH")]})]})]})},s.id)})})})]}),r===2&&e.jsxs("div",{className:"card border-0 shadow-sm mb-4",children:[e.jsx("div",{className:"card-header bg-white border-bottom py-3",children:e.jsx("h4",{className:"mb-0",children:"Delivery Information"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Full Name"}),e.jsx("input",{type:"text",className:"form-control py-2",value:d.user.name,readOnly:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Contact Number"}),e.jsx("span",{className:"text-danger",children:"*"}),e.jsx("input",{type:"text",className:"form-control py-2",value:d.user.phone_number||"Not set",readOnly:!0}),!d.user.phone_number&&e.jsxs("div",{className:"form-text text-secondary mt-1",children:["Click"," ",e.jsx(c,{href:"/profile",className:"text-secondary text-decoration-underline fw-medium",children:"Profile"})," ","to add your phone number"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Delivery Address"}),e.jsx("span",{className:"text-danger",children:"*"}),e.jsx("textarea",{className:"form-control py-2",rows:"3",value:d.user.address||"Not set",readOnly:!0}),!d.user.address&&e.jsxs("div",{className:"form-text text-secondary mt-1",children:["Click"," ",e.jsx(c,{href:"/profile",className:"text-secondary text-decoration-underline fw-medium",children:"Profile"})," ","to add your delivery address"]})]}),e.jsxs("div",{className:"form-text text-secondary mb-3",children:["Edit your info"," ",e.jsx(c,{href:"/settings",className:"text-secondary text-decoration-underline fw-medium",children:"here"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Special Instructions"}),e.jsx("textarea",{className:"form-control py-2",rows:"3",placeholder:"Any special instructions for delivery?",value:a.message,onChange:s=>n("message",s.target.value)})]})]})]}),r===3&&e.jsxs("div",{className:"card border-0 shadow-sm mb-4",children:[e.jsx("div",{className:"card-header bg-white border-bottom py-3",children:e.jsx("h4",{className:"mb-0",children:"Payment Details"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-4 p-3 bg-light rounded",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Subtotal:"}),e.jsxs("span",{className:"fw-semibold",children:["₱",t.toLocaleString("en-PH")]})]}),a.payment_type==="downpayment"?e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Down Payment (50%):"}),e.jsxs("span",{className:"fw-semibold",children:["₱",(t*.5).toLocaleString("en-PH")]})]}):e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Full Payment:"}),e.jsxs("span",{className:"fw-semibold",children:["₱",t.toLocaleString("en-PH")]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"d-flex justify-content-between fw-bold fs-5",children:[e.jsx("span",{children:"Total Due Now:"}),e.jsxs("span",{className:"text-dark",children:["₱",a.payment_type==="downpayment"?(t*.5).toLocaleString("en-PH"):t.toLocaleString("en-PH")]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"mb-3",children:"Payment Type"}),e.jsxs("div",{className:"btn-group w-100",role:"group",children:[e.jsxs("button",{type:"button",className:`btn ${a.payment_type==="downpayment"?"btn-dark":"btn-outline-dark"}`,onClick:()=>{n("payment_type","downpayment"),n("down_payment_amount",t*.5)},children:["50% Down Payment (₱",(t*.5).toLocaleString("en-PH"),")"]}),e.jsxs("button",{type:"button",className:`btn ${a.payment_type==="full"?"btn-dark":"btn-outline-dark"}`,onClick:()=>{n("payment_type","full"),n("down_payment_amount",t)},children:["Full Payment (₱",t.toLocaleString("en-PH"),")"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"mb-3",children:"Payment Method"}),e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsxs("div",{className:`p-3 d-flex align-items-center ${a.payment_method==="gcash"?"border-dark bg-dark bg-opacity-10":""}`,style:{cursor:"pointer",borderLeft:`3px solid ${a.payment_method==="gcash"?"#0d6efd":"transparent"}`},onClick:()=>n("payment_method","gcash"),children:[e.jsx("input",{type:"radio",name:"payment_method",className:"form-check-input me-3",value:"gcash",checked:a.payment_method==="gcash",onChange:()=>n("payment_method","gcash"),hidden:!0}),e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"me-3",children:e.jsx("img",{src:"/img/gcash.png",alt:"GCash",style:{width:"32px",height:"32px"}})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{className:"fw-semibold",children:"GCash"}),e.jsx("small",{className:"text-muted",children:"Pay via GCash mobile wallet"})]}),a.payment_method==="gcash"&&e.jsx("i",{className:"bi bi-check-circle-fill text-dark"})]})]}),e.jsx("hr",{className:"m-0"}),e.jsxs("div",{className:`p-3 d-flex align-items-center ${a.payment_method==="inperson"?"border-dark bg-dark bg-opacity-10":""}`,style:{cursor:"pointer",borderLeft:`3px solid ${a.payment_method==="inperson"?"#0d6efd":"transparent"}`},onClick:()=>n("payment_method","inperson"),children:[e.jsx("input",{type:"radio",name:"payment_method",className:"form-check-input me-3",value:"inperson",checked:a.payment_method==="inperson",onChange:()=>n("payment_method","inperson"),hidden:!0}),e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"me-3",children:e.jsx("i",{className:"bi bi-shop fs-4 text-dark"})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{className:"fw-semibold",children:"Pay In-Store"}),e.jsxs("small",{className:"text-muted",children:["Pay directly at our shop"," ",e.jsx(c,{href:"/settings",className:"text-dark text-decoration-underline",children:"[locations]"})]})]}),a.payment_method==="inperson"&&e.jsx("i",{className:"bi bi-check-circle-fill text-dark"})]})]})]})]}),N&&e.jsxs("div",{className:"alert alert-danger",children:[e.jsx("i",{className:"bi bi-exclamation-circle me-2"}),N]}),e.jsxs("button",{className:"btn btn-dark w-100 py-3 fw-bold",disabled:u||b,children:[(u||b)&&e.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),a.payment_method==="gcash"?`Pay ${a.payment_type==="downpayment"?"Down Payment":"Now"}`:"Place Order"]}),e.jsxs("p",{className:"small text-muted mt-3 text-center",children:["By placing your order, you agree to our"," ",e.jsx(c,{href:"/terms",className:"text-decoration-none text-primary",children:"Terms of Service"})," ","and"," ",e.jsx(c,{href:"/privacy",className:"text-decoration-none text-primary",children:"Privacy Policy"}),"."]})]})]}),e.jsxs("div",{className:"d-flex justify-content-between mt-4",children:[r>1&&e.jsx("button",{type:"button",className:"btn btn-outline-secondary px-4 py-2",onClick:C,children:"Back"}),r<3?e.jsx("button",{type:"button",className:"btn btn-dark ms-auto px-4 py-2",onClick:P,children:"Continue"}):e.jsx("div",{className:"ms-auto"})]})]})]})})})})]}),e.jsx(R,{showLogoutModal:w,setShowLogoutModal:x})]})]})};export{Q as default};
