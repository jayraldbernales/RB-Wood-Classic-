import{r as l,j as t,$ as y,S as q}from"./app-CupyZw7M.js";import{M as o}from"./Modal--PeoWE0q.js";import"./divWithClassName-Cl_CX82P.js";import"./index-4SsW87ZX.js";const Q=({show:k,onHide:d,cartItems:c,onRemoveItem:w})=>{const[x,p]=l.useState([]),[r,b]=l.useState({}),[v,g]=l.useState(null),[m,f]=l.useState(c),[u,h]=l.useState(!1);l.useEffect(()=>{p(c.map(e=>e.id)),b(c.reduce((e,s)=>({...e,[s.id]:s.quantity||1}),{})),f(c)},[c]);const C=e=>{p(s=>s.includes(e)?s.filter(a=>a!==e):[...s,e])},S=e=>{var s;return((s=e.images)==null?void 0:s.length)>0?e.images[0].url||`/storage/${e.images[0].image}`:"/placeholder-image.jpg"},n=m.filter(e=>x.includes(e.id)),I=()=>n.reduce((e,s)=>{var N;const a=((N=s.product)==null?void 0:N.price)||0,i=r[s.id]||1;return e+a*i},0),$=async(e,s)=>{try{await axios.patch(route("cart.update",e),{quantity:s})}catch(a){console.error("Failed to update quantity:",a)}},j=(e,s)=>{b(a=>{const i=Math.max(1,(a[e]||1)+s);return $(e,i),{...a,[e]:i}})},F=e=>{g(e),setTimeout(()=>{f(s=>s.filter(a=>a.id!==e)),w(e),g(null)},300)};return t.jsxs(o,{show:k,onHide:d,centered:!0,size:"lg",className:"cart-modal",children:[t.jsx(o.Header,{closeButton:!0,className:"border-bottom-0 bg-light",children:t.jsxs(o.Title,{className:"fw-bold fs-5",children:[t.jsx("i",{className:"bi bi-cart3 me-2"}),"Your Shopping Cart"]})}),t.jsx(o.Body,{className:"p-0 d-flex flex-column",style:{maxHeight:"70vh",minHeight:"200px",overflow:"hidden"},children:m.length===0?t.jsxs("div",{className:"text-center py-5 d-flex flex-column align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-cart-x fs-1 text-muted mb-3"}),t.jsx("h5",{className:"mb-4",children:"Your cart is empty"}),t.jsx(y,{href:"/products",className:"btn btn-dark px-4 py-2",onClick:d,children:"Continue Shopping"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"cart-items-scrollable px-3 pt-3",style:{flex:1,overflowY:"auto"},children:m.map(e=>t.jsxs("div",{className:`cart-item d-flex align-items-center mb-3 p-3 rounded ${v===e.id?"removing":""}`,style:{backgroundColor:"#f8f9fa",border:"1px solid #dee2e6",minHeight:"100px"},children:[t.jsxs("div",{className:"form-check custom-checkbox-dark me-3",children:[t.jsx("input",{type:"checkbox",className:"form-check-input",checked:x.includes(e.id),onChange:()=>C(e.id),id:`cart-item-${e.id}`}),t.jsx("label",{className:"form-check-label",htmlFor:`cart-item-${e.id}`})]}),t.jsx("img",{src:S(e.product),alt:e.product.name,className:"rounded me-3",style:{width:"80px",height:"80px",objectFit:"cover"},onError:s=>{s.target.onerror=null,s.target.src="/placeholder-image.jpg"}}),t.jsxs("div",{className:"flex-grow-1",children:[t.jsx("h6",{className:"mb-1 fw-bold text-truncate",children:e.product.name}),t.jsx("div",{className:"d-flex justify-content-between align-items-center",children:t.jsxs("span",{className:"fw-bold text-dark",children:["₱",Number(e.product.price).toLocaleString("en-PH")]})})]}),t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("button",{className:"btn btn-sm btn-outline-secondary me-2",onClick:()=>j(e.id,-1),style:{width:"30px"},children:"−"}),t.jsx("span",{className:"fw-bold",style:{minWidth:"30px",textAlign:"center"},children:r[e.id]}),t.jsx("button",{className:"btn btn-sm btn-outline-secondary ms-2",onClick:()=>j(e.id,1),style:{width:"30px"},children:"+"})]}),t.jsx("button",{className:"btn btn-sm btn-outline-danger ms-3",onClick:()=>F(e.id),style:{width:"30px"},children:t.jsx("i",{className:"bi bi-trash"})})]},e.id))}),t.jsxs("div",{className:"border-top px-3 pt-3 pb-3 bg-white",children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[t.jsx("span",{className:"text-muted",children:"Selected Items:"}),t.jsx("span",{className:"fw-bold",children:n.length})]}),t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[t.jsx("span",{className:"text-muted",children:"Subtotal:"}),t.jsxs("span",{className:"fw-bold fs-5 text-dark",children:["₱",I().toLocaleString("en-PH")]})]}),t.jsx(y,{href:"/checkout",className:`btn btn-dark w-100 py-2 ${n.length===0||u?"disabled":""}`,onClick:async e=>{if(e.preventDefault(),n.length>0&&!u){h(!0);try{await Promise.all(n.map(s=>axios.patch(route("cart.update",s.id),{quantity:r[s.id]}))),q.visit("/checkout",{data:{selectedItems:n.map(s=>s.id),quantities:r},onFinish:()=>{h(!1),d()}})}catch(s){h(!1),console.error("Checkout failed:",s)}}},children:u?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Processing..."]}):"Checkout"})]})]})})]})};export{Q as default};
