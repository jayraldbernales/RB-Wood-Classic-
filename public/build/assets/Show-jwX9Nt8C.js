import{r as l,A as F,m as H,j as e,L as M,$ as m}from"./app-CQPZVfaW.js";import{S as A,N as I}from"./Sidebar-BiF-fdkO.js";import{L as R}from"./LogoutModal-IrwRk79v.js";import"./CartModal -B8QpUqrk.js";import"./Modal-BzAZ3knk.js";import"./divWithClassName-DRtHi257.js";import"./index-zrJ3c4AA.js";const Q=({cartItems:h,total:t,auth:d})=>{l.useEffect(()=>{F.init(),T()},[]);const[c,k]=l.useState(!0),[S,j]=l.useState(!1),[P,C]=l.useState(""),N=()=>k(!c),{data:a,setData:n,post:L,processing:f}=H({items:h,total_amount:t,down_payment_amount:t*.5,message:"",payment_method:"gcash",payment_type:"full"}),[r,p]=l.useState(1),[g,w]=l.useState(!1),[v,_]=l.useState(null),O=()=>p(s=>Math.min(s+1,3)),D=()=>p(s=>Math.max(s-1,1)),$=async s=>{s.preventDefault(),a.payment_method==="gcash"?await E("gcash"):L(route("orders.store"))},E=async s=>{w(!0),_(null);try{const o=a.payment_type==="full"?t:t*.5,x=await fetch(route("orders.store"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,Accept:"application/json"},body:JSON.stringify({payment_method:a.payment_method,payment_type:a.payment_type,total_amount:t,down_payment_amount:o,items:h,message:a.message||"",is_paid:!1})});if(!x.ok){const b=await x.json();throw new Error(b.error||"Failed to create order")}const i=(await x.json()).order.id;console.log("Order created with ID:",i);const y=await fetch(route("paymongo.create-checkout"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,Accept:"application/json"},body:JSON.stringify({amount:o*100,description:`Order #${i} Payment`,payment_method_type:s,metadata:{order_id:i,order_type:a.payment_type,user_id:d.user.id,amount:o}})});if(!y.ok){const b=await y.json();throw new Error(b.error||"Payment processing failed")}const u=await y.json();if(console.log("Payment checkout created:",u),u.checkout_url)localStorage.setItem("pendingOrderId",i),window.location.href=u.checkout_url;else throw new Error("No checkout URL received")}catch(o){console.error("Payment error:",o),_(o.message)}finally{w(!1)}},T=()=>{if(!window.PayMongo){const s=document.createElement("script");s.src="https://js.paymongo.com/v1/paymongo.js",s.async=!0,s.onload=()=>console.log("PayMongo SDK loaded."),document.body.appendChild(s)}};return e.jsxs("div",{className:`d-flex ${c?"sidebar-open":""}`,style:{overflow:"hidden"},children:[e.jsx(M,{title:"Checkout"}),e.jsx(A,{sidebarOpen:c,toggleSidebar:N}),e.jsxs("div",{className:"content flex-grow-1",style:{marginLeft:c?"220px":"0",transition:"margin-left 0.3s ease",backgroundColor:"#F8F9FA",minHeight:"100vh"},children:[e.jsxs("div",{className:"position-relative",style:{paddingTop:"50px"},children:[e.jsx(I,{toggleSidebar:N,setShowLogoutModal:j,searchTerm:P,setSearchTerm:C}),e.jsx("div",{className:"container-fluid px-0",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-lg-12",children:e.jsxs("div",{className:"px-4 py-5 mt-2",style:{maxWidth:"1000px",margin:"0 auto"},children:[e.jsxs("div",{className:"mb-5",style:{marginBottom:"4rem"},children:[" ",e.jsx("h2",{className:"fw-bold mb-4",children:"Checkout"})," ",e.jsxs("div",{className:"d-flex align-items-center",style:{marginBottom:"3rem"},children:[" ",e.jsxs("div",{className:"flex-grow-1 position-relative",style:{zIndex:1},children:[e.jsx("div",{className:"progress",style:{height:"8px",marginBottom:"2.5rem"},children:e.jsx("div",{className:"progress-bar bg-dark",role:"progressbar",style:{width:`${r/3*100}%`}})}),e.jsx("div",{className:"d-flex justify-content-between position-absolute w-100",style:{top:"1rem"},children:[1,2,3].map(s=>e.jsxs("div",{className:`d-flex flex-column align-items-center ${r>=s?"text-dark":"text-muted"}`,style:{cursor:"pointer"},onClick:()=>r>=s&&p(s),children:[e.jsx("div",{className:`rounded-circle d-flex align-items-center justify-content-center ${r>=s?"bg-dark text-white":"bg-light"}`,style:{width:"36px",height:"36px",fontWeight:"600"},children:s}),e.jsxs("small",{className:"mt-2 text-nowrap",style:{fontSize:"0.85rem"},children:[s===1&&"Order Summary",s===2&&"Delivery Info",s===3&&"Payment"]})]},s))})]})]})]}),e.jsxs("form",{onSubmit:$,children:[r===1&&e.jsxs("div",{className:"card border-0 shadow-sm mb-4",children:[" ",e.jsxs("div",{className:"card-header bg-white border-bottom py-3 mt-4",children:[" ",e.jsx("h4",{className:"mb-0",children:"Order Summary"})]}),e.jsx("div",{className:"card-body p-0",children:e.jsx("div",{className:"list-group list-group-flush",children:h.map(s=>{var o;return e.jsx("div",{className:"list-group-item border-0 py-3 px-4",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("img",{src:((o=s.product.images[0])==null?void 0:o.url)||"/placeholder-image.jpg",alt:s.product.name,className:"rounded me-3",style:{width:"80px",height:"80px",objectFit:"cover"}}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h6",{className:"mb-1 fw-semibold",children:s.product.name}),e.jsxs("p",{className:"text-muted small mb-1",children:["Quantity:"," ",s.quantity]}),e.jsxs("p",{className:"mb-0 fw-semibold",children:["₱",(s.product.price*s.quantity).toLocaleString("en-PH")]})]})]})},s.id)})})})]}),r===2&&e.jsxs("div",{className:"card border-0 shadow-sm mb-4",children:[e.jsx("div",{className:"card-header bg-white border-bottom py-3",children:e.jsx("h4",{className:"mb-0",children:"Delivery Information"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Full Name"}),e.jsx("input",{type:"text",className:"form-control py-2",value:d.user.name,readOnly:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Contact Number"}),e.jsx("span",{className:"text-danger",children:"*"}),e.jsx("input",{type:"text",className:"form-control py-2",value:d.user.phone_number||"Not set",readOnly:!0}),!d.user.phone_number&&e.jsxs("div",{className:"form-text text-secondary mt-1",children:["Click"," ",e.jsx(m,{href:"/profile",className:"text-secondary text-decoration-underline fw-medium",children:"Profile"})," ","to add your phone number"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Delivery Address"}),e.jsx("span",{className:"text-danger",children:"*"}),e.jsx("textarea",{className:"form-control py-2",rows:"3",value:d.user.address||"Not set",readOnly:!0}),!d.user.address&&e.jsxs("div",{className:"form-text text-secondary mt-1",children:["Click"," ",e.jsx(m,{href:"/profile",className:"text-secondary text-decoration-underline fw-medium",children:"Profile"})," ","to add your delivery address"]})]}),e.jsxs("div",{className:"form-text text-secondary mb-3",children:["Edit your info"," ",e.jsx(m,{href:"/settings",className:"text-secondary text-decoration-underline fw-medium",children:"here"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Special Instructions"}),e.jsx("textarea",{className:"form-control py-2",rows:"3",placeholder:"Any special instructions for delivery?",value:a.message,onChange:s=>n("message",s.target.value)})]})]})]}),r===3&&e.jsxs("div",{className:"card border-0 shadow-sm mb-4",children:[e.jsx("div",{className:"card-header bg-white border-bottom py-3",children:e.jsx("h4",{className:"mb-0",children:"Payment Details"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-4 p-3 bg-light rounded",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Subtotal:"}),e.jsxs("span",{className:"fw-semibold",children:["₱",t.toLocaleString("en-PH")]})]}),a.payment_type==="downpayment"?e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Down Payment (50%):"}),e.jsxs("span",{className:"fw-semibold",children:["₱",(t*.5).toLocaleString("en-PH")]})]}):e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Full Payment:"}),e.jsxs("span",{className:"fw-semibold",children:["₱",t.toLocaleString("en-PH")]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"d-flex justify-content-between fw-bold fs-5",children:[e.jsx("span",{children:"Total Due Now:"}),e.jsxs("span",{className:"text-dark",children:["₱",a.payment_type==="downpayment"?(t*.5).toLocaleString("en-PH"):t.toLocaleString("en-PH")]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"mb-3",children:"Payment Type"}),e.jsxs("div",{className:"btn-group w-100",role:"group",children:[e.jsxs("button",{type:"button",className:`btn ${a.payment_type==="downpayment"?"btn-dark":"btn-outline-dark"}`,onClick:()=>{n("payment_type","downpayment"),n("down_payment_amount",t*.5)},children:["50% Down Payment (₱",(t*.5).toLocaleString("en-PH"),")"]}),e.jsxs("button",{type:"button",className:`btn ${a.payment_type==="full"?"btn-dark":"btn-outline-dark"}`,onClick:()=>{n("payment_type","full"),n("down_payment_amount",t)},children:["Full Payment (₱",t.toLocaleString("en-PH"),")"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"mb-3",children:"Payment Method"}),e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsxs("div",{className:`p-3 d-flex align-items-center ${a.payment_method==="gcash"?"border-dark bg-dark bg-opacity-10":""}`,style:{cursor:"pointer",borderLeft:`3px solid ${a.payment_method==="gcash"?"#0d6efd":"transparent"}`},onClick:()=>n("payment_method","gcash"),children:[e.jsx("input",{type:"radio",name:"payment_method",className:"form-check-input me-3",value:"gcash",checked:a.payment_method==="gcash",onChange:()=>n("payment_method","gcash"),hidden:!0}),e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"me-3",children:e.jsx("img",{src:"/img/gcash.png",alt:"GCash",style:{width:"32px",height:"32px"}})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{className:"fw-semibold",children:"GCash"}),e.jsx("small",{className:"text-muted",children:"Pay via GCash mobile wallet"})]}),a.payment_method==="gcash"&&e.jsx("i",{className:"bi bi-check-circle-fill text-dark"})]})]}),e.jsx("hr",{className:"m-0"}),e.jsxs("div",{className:`p-3 d-flex align-items-center ${a.payment_method==="inperson"?"border-dark bg-dark bg-opacity-10":""}`,style:{cursor:"pointer",borderLeft:`3px solid ${a.payment_method==="inperson"?"#0d6efd":"transparent"}`},onClick:()=>n("payment_method","inperson"),children:[e.jsx("input",{type:"radio",name:"payment_method",className:"form-check-input me-3",value:"inperson",checked:a.payment_method==="inperson",onChange:()=>n("payment_method","inperson"),hidden:!0}),e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"me-3",children:e.jsx("i",{className:"bi bi-shop fs-4 text-dark"})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{className:"fw-semibold",children:"Pay In-Store"}),e.jsxs("small",{className:"text-muted",children:["Pay directly at our shop"," ",e.jsx(m,{href:"/settings",className:"text-dark text-decoration-underline",children:"[locations]"})]})]}),a.payment_method==="inperson"&&e.jsx("i",{className:"bi bi-check-circle-fill text-dark"})]})]})]})]}),v&&e.jsxs("div",{className:"alert alert-danger",children:[e.jsx("i",{className:"bi bi-exclamation-circle me-2"}),v]}),e.jsxs("button",{className:"btn btn-dark w-100 py-3 fw-bold",disabled:f||g,children:[(f||g)&&e.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),a.payment_method==="gcash"?`Pay ${a.payment_type==="downpayment"?"Down Payment":"Now"}`:"Place Order"]}),e.jsx("p",{className:"small text-muted mt-3 text-center",children:"By placing your order, you agree to our Terms of Service and Privacy Policy."})]})]}),e.jsxs("div",{className:"d-flex justify-content-between mt-4",children:[r>1&&e.jsx("button",{type:"button",className:"btn btn-outline-secondary px-4 py-2",onClick:D,children:"Back"}),r<3?e.jsx("button",{type:"button",className:"btn btn-dark ms-auto px-4 py-2",onClick:O,children:"Continue"}):e.jsx("div",{className:"ms-auto"})]})]})]})})})})]}),e.jsx(R,{showLogoutModal:S,setShowLogoutModal:j})]})]})};export{Q as default};
